<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Ceph RADOS Library: Watch/Notify</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ceph RADOS Library
   &#160;<span id="projectnumber">60e2bec73ff3970e0c6b44250ce465e6c5dde56f</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Watch/Notify</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga3ed009a14f2fd15dc7a4fe337f3649d5"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga3ed009a14f2fd15dc7a4fe337f3649d5">rados_watchcb_t</a> )(uint8_t opcode, uint64_t ver, void *arg)</td></tr>
<tr class="separator:ga3ed009a14f2fd15dc7a4fe337f3649d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae4042feb1602b9df19dac7ff496920d3"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gae4042feb1602b9df19dac7ff496920d3">rados_watchcb2_t</a> )(void *arg, uint64_t notify_id, uint64_t handle, uint64_t notifier_id, void *data, size_t data_len)</td></tr>
<tr class="separator:gae4042feb1602b9df19dac7ff496920d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga03fa31d268200b63ae696a9b7d7806f4"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga03fa31d268200b63ae696a9b7d7806f4">rados_watcherrcb_t</a> )(void *pre, uint64_t cookie, int err)</td></tr>
<tr class="separator:ga03fa31d268200b63ae696a9b7d7806f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6f26b36eb0042935caf4338a447e473b"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga6f26b36eb0042935caf4338a447e473b">rados_watch</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, uint64_t ver, uint64_t *cookie, <a class="el" href="group__librados__h__watch__notify.html#ga3ed009a14f2fd15dc7a4fe337f3649d5">rados_watchcb_t</a> watchcb, void *arg) __attribute__((deprecated))</td></tr>
<tr class="separator:ga6f26b36eb0042935caf4338a447e473b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1e9999a4cab56748425c53b436c9f3ff"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga1e9999a4cab56748425c53b436c9f3ff">rados_watch2</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, uint64_t *cookie, <a class="el" href="group__librados__h__watch__notify.html#gae4042feb1602b9df19dac7ff496920d3">rados_watchcb2_t</a> watchcb, <a class="el" href="group__librados__h__watch__notify.html#ga03fa31d268200b63ae696a9b7d7806f4">rados_watcherrcb_t</a> watcherrcb, void *arg)</td></tr>
<tr class="separator:ga1e9999a4cab56748425c53b436c9f3ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga41031bd4a4fe0515507bc62b12c7c34f"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga41031bd4a4fe0515507bc62b12c7c34f">rados_watch_check</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, uint64_t cookie)</td></tr>
<tr class="separator:ga41031bd4a4fe0515507bc62b12c7c34f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad83de38adfb370d9e0aa11476a1d0fb2"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gad83de38adfb370d9e0aa11476a1d0fb2">rados_unwatch</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, uint64_t cookie) __attribute__((deprecated))</td></tr>
<tr class="separator:gad83de38adfb370d9e0aa11476a1d0fb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf7468fc1e70070f2e306a6729e10a3ce"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gaf7468fc1e70070f2e306a6729e10a3ce">rados_unwatch2</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, uint64_t cookie)</td></tr>
<tr class="separator:gaf7468fc1e70070f2e306a6729e10a3ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae3370754262b3593eb320c021782fb6c"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gae3370754262b3593eb320c021782fb6c">rados_notify</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, uint64_t ver, const char *buf, int buf_len) __attribute__((deprecated))</td></tr>
<tr class="separator:gae3370754262b3593eb320c021782fb6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac14c542aeec3a5e5a2438f0e0fc511bd"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gac14c542aeec3a5e5a2438f0e0fc511bd">rados_notify2</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, const char *buf, int buf_len, uint64_t timeout_ms, char **reply_buffer, size_t *reply_buffer_len)</td></tr>
<tr class="separator:gac14c542aeec3a5e5a2438f0e0fc511bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa9190c17b299ea172324ecd2f82559f1"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#gaa9190c17b299ea172324ecd2f82559f1">rados_notify_ack</a> (<a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a> io, const char *o, uint64_t notify_id, uint64_t cookie, const char *buf, int buf_len)</td></tr>
<tr class="separator:gaa9190c17b299ea172324ecd2f82559f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga318a5626111fcebbc9133720a253003c"><td class="memItemLeft" align="right" valign="top">CEPH_RADOS_API int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__librados__h__watch__notify.html#ga318a5626111fcebbc9133720a253003c">rados_watch_flush</a> (<a class="el" href="librados_8h.html#abda043338e76ae05b784cc194ff15cfa">rados_t</a> cluster)</td></tr>
<tr class="separator:ga318a5626111fcebbc9133720a253003c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Watch/notify is a protocol to help communicate among clients. It can be used to sychronize client state. All that's needed is a well-known object name (for example, rbd uses the header object of an image).</p>
<p>Watchers register an interest in an object, and receive all notifies on that object. A notify attempts to communicate with all clients watching an object, and blocks on the notifier until each client responds or a timeout is reached.</p>
<p>See <a class="el" href="group__librados__h__watch__notify.html#ga6f26b36eb0042935caf4338a447e473b">rados_watch()</a> and <a class="el" href="group__librados__h__watch__notify.html#gae3370754262b3593eb320c021782fb6c">rados_notify()</a> for more details. </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gae4042feb1602b9df19dac7ff496920d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rados_watchcb2_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback activated when a notify is received on a watched object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>opaque user-defined value provided to <a class="el" href="group__librados__h__watch__notify.html#ga1e9999a4cab56748425c53b436c9f3ff">rados_watch2()</a> </td></tr>
    <tr><td class="paramname">notify_id</td><td>an id for this notify event </td></tr>
    <tr><td class="paramname">handle</td><td>the watcher handle we are notifying </td></tr>
    <tr><td class="paramname">notifier_id</td><td>the unique client id for the notifier </td></tr>
    <tr><td class="paramname">data</td><td>payload from the notifier </td></tr>
    <tr><td class="paramname">datalen</td><td>length of payload buffer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga3ed009a14f2fd15dc7a4fe337f3649d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rados_watchcb_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback activated when a notify is received on a watched object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">opcode</td><td>undefined </td></tr>
    <tr><td class="paramname">ver</td><td>version of the watched object </td></tr>
    <tr><td class="paramname">arg</td><td>application-specific data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>BUG: opcode is an internal detail that shouldn't be exposed </dd>
<dd>
BUG: ver is unused </dd></dl>

</div>
</div>
<a class="anchor" id="ga03fa31d268200b63ae696a9b7d7806f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rados_watcherrcb_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback activated when we encounter an error with the watch session. This can happen when the location of the objects moves within the cluster and we fail to register our watch with the new object location, or when our connection with the object OSD is otherwise interrupted and we may have missed notify events.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pre</td><td>opaque user-defined value provided to <a class="el" href="group__librados__h__watch__notify.html#ga1e9999a4cab56748425c53b436c9f3ff">rados_watch2()</a> </td></tr>
    <tr><td class="paramname">err</td><td>error code </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gae3370754262b3593eb320c021782fb6c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_notify </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buf_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sychronously notify watchers of an object</p>
<p>This blocks until all watchers of the object have received and reacted to the notify, or a timeout is reached.</p>
<dl class="section note"><dt>Note</dt><dd>BUG: the timeout is not changeable via the C API </dd>
<dd>
BUG: the bufferlist is inaccessible in a rados_watchcb_t</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the name of the object </td></tr>
    <tr><td class="paramname">ver</td><td>obsolete - just pass zero </td></tr>
    <tr><td class="paramname">buf</td><td>data to send to watchers </td></tr>
    <tr><td class="paramname">buf_len</td><td>length of buf in bytes </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="gac14c542aeec3a5e5a2438f0e0fc511bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_notify2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buf_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>timeout_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>reply_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>reply_buffer_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sychronously notify watchers of an object</p>
<p>This blocks until all watchers of the object have received and reacted to the notify, or a timeout is reached.</p>
<p>The reply buffer is optional. If specified, the client will get back an encoded buffer that includes the ids of the clients that acknowledged the notify as well as their notify ack payloads (if any). Clients that timed out are not included. Even clients that do not include a notify ack payload are included in the list but have a 0-length payload associated with them. The format:</p>
<p>le32 num_acks { le64 gid global id for the client (for client.1234 that's 1234) le64 cookie cookie for the client le32 buflen length of reply message buffer u8 * buflen payload } * num_acks le32 num_timeouts { le64 gid global id for the client le64 cookie cookie for the client } * num_timeouts</p>
<p>Note: There may be multiple instances of the same gid if there are multiple watchers registered via the same client.</p>
<p>Note: The buffer must be released with <a class="el" href="group__librados__h__commands.html#gae9e2a3c60e90c9a6ffee2b375323277e">rados_buffer_free()</a> when the user is done with it.</p>
<p>Note: Since the result buffer includes clients that time out, it will be set even when <a class="el" href="group__librados__h__watch__notify.html#gae3370754262b3593eb320c021782fb6c">rados_notify()</a> returns an error code (like -ETIMEDOUT).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the name of the object </td></tr>
    <tr><td class="paramname">buf</td><td>data to send to watchers </td></tr>
    <tr><td class="paramname">buf_len</td><td>length of buf in bytes </td></tr>
    <tr><td class="paramname">timeout_ms</td><td>notify timeout (in ms) </td></tr>
    <tr><td class="paramname">reply_buffer</td><td>pointer to reply buffer pointer (free with rados_buffer_free) </td></tr>
    <tr><td class="paramname">reply_buffer_len</td><td>pointer to size of reply buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="gaa9190c17b299ea172324ecd2f82559f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_notify_ack </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>notify_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>buf_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Acknolwedge receipt of a notify</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the name of the object </td></tr>
    <tr><td class="paramname">notify_id</td><td>the notify_id we got on the watchcb2_t callback </td></tr>
    <tr><td class="paramname">cookie</td><td>the watcher handle </td></tr>
    <tr><td class="paramname">buf</td><td>payload to return to notifier (optional) </td></tr>
    <tr><td class="paramname">buf_len</td><td>payload length </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd></dl>

</div>
</div>
<a class="anchor" id="gad83de38adfb370d9e0aa11476a1d0fb2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_unwatch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>cookie</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unregister an interest in an object</p>
<p>Once this completes, no more notifies will be sent to us for this watch. This should be called to clean up unneeded watchers.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the name of the watched object (ignored) </td></tr>
    <tr><td class="paramname">cookie</td><td>which watch to unregister </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="gaf7468fc1e70070f2e306a6729e10a3ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_unwatch2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>cookie</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unregister an interest in an object</p>
<p>Once this completes, no more notifies will be sent to us for this watch. This should be called to clean up unneeded watchers.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">cookie</td><td>which watch to unregister </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="ga6f26b36eb0042935caf4338a447e473b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_watch </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ver</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__librados__h__watch__notify.html#ga3ed009a14f2fd15dc7a4fe337f3649d5">rados_watchcb_t</a>&#160;</td>
          <td class="paramname"><em>watchcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register an interest in an object</p>
<p>A watch operation registers the client as being interested in notifications on an object. OSDs keep track of watches on persistent storage, so they are preserved across cluster changes by the normal recovery process. If the client loses its connection to the primary OSD for a watched object, the watch will be removed after 30 seconds. Watches are automatically reestablished when a new connection is made, or a placement group switches OSDs.</p>
<dl class="section note"><dt>Note</dt><dd>BUG: watch timeout should be configurable </dd>
<dd>
BUG: librados should provide a way for watchers to notice connection resets </dd>
<dd>
BUG: the ver parameter does not work, and -ERANGE will never be returned (See URL tracker.ceph.com/issues/2592)</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the object to watch </td></tr>
    <tr><td class="paramname">ver</td><td>expected version of the object </td></tr>
    <tr><td class="paramname">cookie</td><td>where to store the internal id assigned to this watch </td></tr>
    <tr><td class="paramname">watchcb</td><td>what to do when a notify is received on this object </td></tr>
    <tr><td class="paramname">arg</td><td>application defined data to pass when watchcb is called </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd>
<dd>
-ERANGE if the version of the object is greater than ver </dd></dl>

</div>
</div>
<a class="anchor" id="ga1e9999a4cab56748425c53b436c9f3ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_watch2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>o</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>cookie</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__librados__h__watch__notify.html#gae4042feb1602b9df19dac7ff496920d3">rados_watchcb2_t</a>&#160;</td>
          <td class="paramname"><em>watchcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__librados__h__watch__notify.html#ga03fa31d268200b63ae696a9b7d7806f4">rados_watcherrcb_t</a>&#160;</td>
          <td class="paramname"><em>watcherrcb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register an interest in an object</p>
<p>A watch operation registers the client as being interested in notifications on an object. OSDs keep track of watches on persistent storage, so they are preserved across cluster changes by the normal recovery process. If the client loses its connection to the primary OSD for a watched object, the watch will be removed after 30 seconds. Watches are automatically reestablished when a new connection is made, or a placement group switches OSDs.</p>
<dl class="section note"><dt>Note</dt><dd>BUG: watch timeout should be configurable</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">o</td><td>the object to watch </td></tr>
    <tr><td class="paramname">cookie</td><td>where to store the internal id assigned to this watch </td></tr>
    <tr><td class="paramname">watchcb</td><td>what to do when a notify is received on this object </td></tr>
    <tr><td class="paramname">watcherrcb</td><td>what to do when the watch session encounters an error </td></tr>
    <tr><td class="paramname">arg</td><td>opaque value to pass to the callback </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="ga41031bd4a4fe0515507bc62b12c7c34f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_watch_check </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#aa892568c6a8b4f1c07785b228014e3e3">rados_ioctx_t</a>&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>cookie</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check on the status of a watch</p>
<p>Return the number of milliseconds since the watch was last confirmed. Or, if there has been an error, return that.</p>
<p>If there is an error, the watch is no longer valid, and should be destroyed with <a class="el" href="group__librados__h__watch__notify.html#gaf7468fc1e70070f2e306a6729e10a3ce">rados_unwatch2()</a>. The the user is still interested in the object, a new watch should be created with <a class="el" href="group__librados__h__watch__notify.html#ga1e9999a4cab56748425c53b436c9f3ff">rados_watch2()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io</td><td>the pool the object is in </td></tr>
    <tr><td class="paramname">cookie</td><td>the watch handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ms since last confirmed on success, negative error code on failure </dd></dl>

</div>
</div>
<a class="anchor" id="ga318a5626111fcebbc9133720a253003c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CEPH_RADOS_API int rados_watch_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="librados_8h.html#abda043338e76ae05b784cc194ff15cfa">rados_t</a>&#160;</td>
          <td class="paramname"><em>cluster</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flush watch/notify callbacks</p>
<p>This call will block until all pending watch/notify callbacks have been executed and the queue is empty. It should usually be called after shutting down any watches before shutting down the ioctx or librados to ensure that any callbacks do not misuse the ioctx (for example by calling rados_notify_ack after the ioctx has been destroyed).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cluster</td><td>the cluster handle </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 5 2015 14:26:23 for Ceph RADOS Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
